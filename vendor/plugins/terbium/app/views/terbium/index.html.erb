<% @title = controller.controller_name.humanize %>
<h1><%= @title %></h1>
<% if respond_to? :will_paginate %>
  <%= would_paginate @records, :url => resources_path(:page => '') %>
<% end %>
<div class="columns">
  <div class="row">
    <div class="column left_column">
    <% if @records.empty? %>
      <p>Sorry, but there is no records in <%= controller.controller_name.humanize %></p>
    <% else %>
      <table class="list_table">
        <thead>
          <tr>
          <% controller.index_fields.each do |field| -%>
            <th><%= raw render_head(field) %></th>
          <% end -%>
            <th class="actions">Actions</th>
          </tr>
        </thead>
        <tbody>
        <% @records.each do |record| -%>
          <tr>
          <% controller.index_fields.each do |field| -%>
            <td><%= render_field record, field %></td>
          <% end -%>
            <td class="actions">
              <% controller.terbium_actions.each do |action| %>
                <%= link_to action.to_s.humanize, resource_path(record, action) %>
              <% end %>
              <%= link_to 'show', resource_path(record), :class => 'show_entry' if controller.show_fields || resource_children.present? %>
              <%= link_to 'edit', edit_resource_path(record), :class => 'edit_entry' if controller.update_fields || controller.form_fields %>
              <%= link_to 'destroy', resource_path(record), :confirm => "Are you sure?", :method => :delete, :class => 'remove_entry' if controller.terbium_config.destroy %>
              <% resource_children.each do |child| %>
                <% if child.plural? %>
                  <p><%= link_to "#{child.humanize}(#{record.send(child).size})", resource_child_path(record, child) %></p>
                <% else %>
                  <p><%= link_to "#{record.send(child) ? 'Edit' : 'Add'} #{child.humanize}", resource_child_path(record, child) %></p>
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end -%>
        </tbody>
      </table>
    <% end %>
    </div>
    <div class="column right_column panel">
      <dl>
        <dt>Search</dt>
        <dd>
        <%= form_tag resources_path, {:method => :get} do %>
          <%= text_field_tag :query, resource_session[:query] %>
          <%= submit_tag 'Search' %>
          <% if resource_session[:query].present? %>
            <%= link_to 'clear', resources_path(:query => '') %>
          <% end %>
        <% end %>
        </dd>
        <% boolean_fields.each do |field| %>
          <dt><%= field.label %></dt>
          <dd>
            <ul>
              <% [['All', nil], ['Yes', '1'], ['No', '0'], ['Not set', 'nil']].each do |option| %>
                <li><%= link_to_unless resource_session[:boolean][field.query_column] == option[1], option[0], resources_path(:boolean => { field.query_column => option[1]}) %></li>
              <% end %>
            </ul>
          </dd>
        <% end %>
      </dl>
    </div>
  </div>
</div>
<% if respond_to? :will_paginate %>
  <%= would_paginate @records, :url => resources_path(:page => '') %>
<% end %>

<% content_for :additional_navigation do %>
<ul class="buttons">
  <% 0.upto(resource_ancestors_records.length - 1) do |i| %>
    <li><%= link_to resource_ancestors[i].to_s.pluralize.humanize, polymorphic_path([route_prefix] + resource_ancestors_records[0..i-3] + [resource_ancestors[i].to_s.pluralize]) %></li>
    <li><%= link_to resource_ancestors_records[i].to_title, polymorphic_path([route_prefix] + resource_ancestors_records[0..i]) %></li>
  <% end %>
  <% if controller.create_fields || controller.form_fields %>
    <li><%= link_to "New #{controller.model_name.humanize.downcase}", new_resource_path %></li>
  <% end %>
</ul>
<% end %>
