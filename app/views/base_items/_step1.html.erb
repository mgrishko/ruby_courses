<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr class="th">
    <td>GNT</td>
    <td colspan="4"><%= t 'item.internal_item_id' %></td>
  </tr>
  <tr>
    <td>
        <div class="cont-dd-input">
      <%= f.text_field :gtin, :class=>'w156 dd-input' %>
      										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.gtin_hint')%>
										</div>
									</div>
    </td>
    <td colspan="4">
        <div class="cont-dd-input">
      <%= f.text_field :internal_item_id, :class=>'w156 dd-input' %>
      										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.internal_item_id_hint')%>
										</div>
									</div>
    </td>
  </tr>
  <tr class="th">
    <td><%= t 'item.brand' %> (70)</td>
    <td><%= t 'item.subbrand' %> (70)</td>
    <td><%= t 'item.functional' %> (35)</td>
    <td><%= t 'item.variant' %> (35)</td>
    <td><%= t 'item.content' %></td>
  </tr>
  <tr>
    <td>
    <div class="cont-dd-input">
      <%= f.autocomplete_field :brand, autocomplete_base_item_brand_base_items_path, :class=>'w156 dd-input' %>
										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.brand_hint')%>
										</div>
									</div>
    </td>
    <td>
        <div class="cont-dd-input">
      <%= f.autocomplete_field :subbrand, autocomplete_base_item_subbrand_base_items_path, :class=>'w156 dd-input' %>
										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.subbrand_hint')%>
										</div>
									</div>
    </td>
    <td>
            <div class="cont-dd-input">
      <%= f.autocomplete_field :functional, autocomplete_base_item_functional_base_items_path, :class=>'w132 dd-input' %>
      										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.functional_hint')%>
										</div>
									</div>
    </td>
    <td>
                <div class="cont-dd-input">
      <%= f.autocomplete_field :variant, autocomplete_base_item_variant_base_items_path, :class=>'w132 dd-input' %>
            										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.variant_hint')%>
										</div>
									</div>
    </td>
    <td width="155px" height="20px">
                    <div class="cont-dd-input">
      <%= f.text_field :content, :class=>'w40 dd-input fleft'%>
            										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.content_hint')%>
										</div>
									</div>
      <div class="drop-down-cont units pad-l-5 zi-1 " >
        <%= f.hidden_field :content_uom, :class => "w100 dd-input" %>
        <a class="drop-down-link" href="#"><%= ( @base_item.content_uom.present? ) ?  @base_item.calculate_content : 'Select' %></a>
        <div class="drop-down">
          <div class="blue-tarr"></div>
          <div class="drop-down-list-cont">
            <div class="drop-down-list first">
              <ul>
                <% (@base_item.content_uoms).each do |uom| %>
                  <li>
                    <%= link_to "#{uom[0] if uom}", '#' %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </td>
  </tr>
  <tr class="th">
    <td colspan="5"><%= t 'item.description' %> (178)</td>
  </tr>
  <tr>
    <td colspan="5">
                      <div class="cont-dd-input">
      <%= f.autocomplete_field :item_description, autocomplete_base_item_item_description_base_items_path, :class => "w759 dd-input" %>
            										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.item_description_hint')%>
										</div>
									</div>
    </td>
  </tr>
  <tr class="th">
    <td><%= t 'item.manufacturer_gln' %></td>
    <td><%= t 'item.manufacturer_name' %></td>
    <td colspan="3"><%= t 'item.country_of_origin' %></td>
  </tr>
  <tr>
    <td>
                          <div class="cont-dd-input">
      <%= f.autocomplete_field :manufacturer_gln, autocomplete_base_item_manufacturer_gln_base_items_path, :class=>'w156 dd-input', :update_elements => {:manufacturer_name => '#base_item_manufacturer_name'} %>
                  										<div class="drop-down hint2">
											<div class="blue-barr"></div>
										<%= t('item.manufacturer_gln_hint')%>
										</div>
									</div>
    </td>
    <td>
                          <div class="cont-dd-input">
      <%= f.autocomplete_field :manufacturer_name, autocomplete_base_item_manufacturer_name_base_items_path, :class=>'w156 dd-input', :update_elements => {:manufacturer_gln => '#base_item_manufacturer_gln'} %>
                  										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.manufacturer_name_hint')%>
										</div>
									</div>
    </td>
    <td colspan="3">
      <div id="country_input">
        <div class="drop-down-cont zi-2">
          <%= f.hidden_field :country_of_origin_code %>
          <%= f.text_field :country, :class => 'dd-input w132', :onkeyup => 'setCountrySelection(this)' %>
          <div class="drop-down">
            <div class="blue-tarr"></div>
            <div class="drop-down-list-cont">
              <div class="drop-down-list first" id='countries_div'>
                <ul>
                  <%= render :partial => "main/country", :collection => Country.all(:order => 'code') %>
                </ul>
              </div>
            </div>
            <div class="remark"><%= t 'main.annotations' %><br/><br/><br/>
            </div>
            <%= link_to I18n.t('main.apply'), "#", :id => 'country_select_btn', :class => 'submit-btn2' %>
          </div>
        </div>
      </div>
    </td>
  </tr>
  <tr class="th">
    <td colspan="5"><%= t 'item.gpc_code' %></td>
  </tr>
  <tr>
    <td colspan="5">
      <div id="classifier_input">
        <div class="dd-overlay"></div>
        <div class="drop-down-cont zi-3">
          <%= f.hidden_field :gpc_code, :class => "w100 dd-input" %>
          <%= link_to "#{@base_item.gpc_name ? @base_item.gpc_name : I18n.t('main.select')}", "#", :id => 'base_item_gpc_name_link', :class => "drop-down-link" %>
          <div class="drop-down">
            <div class="blue-tarr"></div>
            <div class="drop-down-list-cont w783">
              <div id='groups' class="drop-down-list first w260">
              </div>
              <div id='subgroups' class="drop-down-list w260">
              </div>
              <div id='categories' class="drop-down-list w260">
              </div>
              <div id='definition' class="remark">
              </div>
            </div>
            <%= link_to I18n.t('main.apply'), "javascript:void(0)", :class => "submit-btn2", :id => "gpc_select_btn" %>
          </div>
        </div>
      </div>
      </div>
    </td>
  </tr>
  <tr class="th">
    <td>Vat</td>
    <td colspan="4"><%= t 'item.shelf_life_period' %></td>
  </tr>
  <tr>
    <td>
      <div class="drop-down-cont vat zi-4 ">
        <%= f.hidden_field :vat, :class => "w100 dd-input" %>
        <%= link_to "#{@base_item.id ? @base_item.calculate_vat : I18n.t('main.select')}", '#', :class => 'drop-down-link' %>
        <div class="drop-down">
          <div class="blue-tarr"></div>
          <div class="drop-down-list-cont">
            <div class="drop-down-list first">
              <ul>
                <% @base_item.vats.each do |v| %>
                    <li><a href="#"><%= v[0] %></a></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </td>
    <td colspan="4">
                    <div class="cont-dd-input">
      <%= f.text_field :minimum_durability_from_arrival, :class=>'w50 dd-input' %>
                        										<div class="drop-down hint2">
											<div class="blue-barr"></div>
											<%= t('item.minimum_durability_from_arrival_hint')%>
										</div>
									</div>
      <span class="days"><%= t 'main.days' %></span>
    </td>
  </tr>
</table>
<div class="dd-overlay"></div>
<%= javascript_include_tag 'dropdowns' %>
<script type="text/javascript">
    var setCountrySelection = function(obj){
      var input=$(obj).val().toLowerCase();
      $(obj).parent().find('ul li').each(function(){
        var country = $(this).find('a').html().toLowerCase();
        if (country.indexOf(input) == 0){
          $('#countries_div').scrollTo( $(this), 600);
          if (country == input)
            $(this).addClass('selected');
          return false;
        }
      });
    };
    var uoms_names = {};
    <%@base_item.content_uoms.each do |p|%>
      uoms_names['<%= p[1]%>'] = '<%= p[0]%>';
    <%end%>

    var uoms = {};
    <%@base_item.content_uoms.each do |p|%>
    uoms['<%= p[0]%>'] = '<%= p[1]%>';
    <%end%>
    var vats = {};
    <%@base_item.vats.each do |p|%>
    vats['<%= p[0]%>'] = '<%= p[1]%>';
    <%end%>

  $('#base_item_manufacturer_gln').bind('railsAutocomplete.select', function(event,ui){
    $('#base_item_manufacturer_gln').val(this.value.split(' : ')[0]);
  });
  $('#base_item_manufacturer_name').bind('railsAutocomplete.select', function(event,ui){
    $('#base_item_manufacturer_name').val(this.value.split(' : ')[1]);
  });

	$('.drop-down-cont.units .drop-down-list ul li a').click(function(){
		$('.drop-down-cont.units').find('.drop-down-link').text($(this).text());
		$('#base_item_content_uom').val(uoms[$(this).text()]);
		PrepareDescriptionString();
		$('.drop-down').css('visibility','hidden');
		$('.dd-overlay').css('display', 'none');
		return false;
	});

	$("#country_select_btn").click(function(){
    $('#country_input .drop-down-list ul li a').each( function(){
      if ($(this).parent().hasClass('selected')){
        $('#base_item_country').val($(this).html());
        $('#base_item_country_of_origin_code').val($(this).parent().attr('id'));
     		$('.drop-down').css('visibility','hidden');
    		$('.dd-overlay').css('display', 'none');
    		return false;
    		}
    });
  });

  $('#base_item_gpc_name_link').click(function(){
    $.ajax({data:$.param($(this).serializeArray()), dataType:'script', type:'post', url:'/main/classifier'});
	});

	$("#gpc_select_btn").click(function(){
    $('#categories ul li a').each( function(){
      if ($(this).parent().hasClass('selected')){
        $('#base_item_gpc_name_link').html($(this).html());
        $('#base_item_gpc_name').val($(this).parent().attr('id'));
        $('#base_item_gpc_code').val($(this).parent().attr('id'));
     	 	$('.drop-down').css('visibility','hidden');
    	 	$('.dd-overlay').css('display', 'none');
       	return false;
      }
    });
  });


<% if params[:action]=='new' %>
  var is_description_touched = false;


  $("#base_item_brand").bind('railsAutocomplete.select', function(event,ui){PrepareDescriptionString();});
	$("#base_item_brand").change(function(){PrepareDescriptionString()});

  $("#base_item_subbrand").bind('railsAutocomplete.select', function(event,ui){PrepareDescriptionString();});
	$("#base_item_subbrand").change(function(){PrepareDescriptionString()});

  $("#base_item_functional").bind('railsAutocomplete.select', function(event,ui){PrepareDescriptionString();});
	$("#base_item_functional").change(function(){PrepareDescriptionString()});

  $("#base_item_content").bind('railsAutocomplete.select', function(event,ui){PrepareDescriptionString();});
	$("#base_item_content").change(function(){PrepareDescriptionString()});

  $("#base_item_content_uom").bind('railsAutocomplete.select', function(event,ui){PrepareDescriptionString();});
	$("#base_item_content_uom").change(function(){PrepareDescriptionString()});


	$("#base_item_item_description").change(function() {
		is_description_touched = true;
	});

	function PrepareDescriptionString(){
    if (!is_description_touched){
		  var string = ""
        string += $("#base_item_brand").val();
        string += " ";
      	string += $("#base_item_subbrand").val();
        string += " ";
      	string += $("#base_item_functional").val();
        string += " ";
       	string += $("#base_item_content").val();
        if ($("#base_item_content_uom").val()){
          string += " ";
        	string += uoms_names[$("#base_item_content_uom").val()];
        	}
     		$("#base_item_item_description").val(string);
      }
		}
<% end %>
</script>

<div id='hidden_div' style="display: none"></div>

