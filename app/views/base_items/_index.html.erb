<div class="fright">
<form method="GET" action="" id="search-form">
<input id="search-form-input" type="text" name="search" value="<% if params[:search].to_s == '' %>Поиск<% else %><%=h params[:search] %><% end %>"/>
<a href="?"><div id="search-clear" class="<% if params[:search].to_s != '' %>search-clear-active<% else %>search-clear-inactive<% end %>"></div></a>
</form>
<div style="clear:both"><%= will_paginate(@base_items) %></div>
</div>
<br/>
<h2>Listing <%= defined?(retailer) ? 'retailer' : 'base' -%> items</h2>
<!--filters-->
<div class="filters">
<% if current_user.supplier? %>
<div>
<strong>Получатели</strong>
<% @receivers.each do |r| %>
  <%= selected_wrapper "<a href='?receiver=#{r.id}' class='filter'>#{r.name}</a> (#{r.q})", params[:receiver].to_s == r.id.to_s %>
<% end %>
</div>
<br/>
<% end %>
<div>
<strong>Тэги</strong>
<% @clouds.each do |c| %>
    <%= selected_wrapper "<a href='?tag=#{c.tag.id}' class='filter'>#{c.tag.name}</a> (#{c.q})", params[:tag].to_s == c.tag_id.to_s %>
<% end %>
</div>
<br/>
<div>
<strong>Бренды</strong>
<% @brands.each do |b| %>
  <%= selected_wrapper "<a href='?brand=#{CGI::escapeHTML b.brand}' class='filter'>#{b.brand}</a> (#{b.q})", params[:brand].to_s == b.brand.to_s %>
<% end %>
</div>
<br/>
<div>
<strong>Производители</strong>
<% @manufacturers.each do |m| %>
  <%= selected_wrapper "<a href='?manufacturer_name=#{CGI::escapeHTML m.manufacturer_name}' class='filter'>#{m.manufacturer_name}</a> (#{m.q})", params[:manufacturer_name].to_s == m.manufacturer_name.to_s %>
<% end %>
</div>
<br/>
<div>
<strong>Functional</strong>
<% @functionals.each do |f| %>
  <%= selected_wrapper "<a href='?functional=#{CGI::escapeHTML f.functional}' class='filter'>#{f.functional}</a> (#{f.q})", params[:functional].to_s == f.functional.to_s %>
<% end %>
</div>

</div>
<!--/filters-->
<!--data-->
<div class="data">
<table class="results">
<%= defined?(retailer) ? '<col></col><col></col>' : '' -%>
<col />
<col width="100" />
<col width="300" />
<col width="200" align="center" />
<col width="50"  align="center" />
<col />
<tr>
<th></th>
<% if defined?(retailer) %>
<th>gln</th>
<th>name</th>
<% end %>
<th>gtin</th>
<th>description</th>
<th>tags</th>
<th>status</th>
<th>date</th>
</tr>
<% @base_items.each do |base_item| %>
	<% path_params = defined?(retailer) ? {:id => base_item.id, :view => true} : base_item %>
  <tr <%= "class='private'" if base_item.item.private %>>
    <td><input type="checkbox" class="checkbox" name="" id=""/></td>
    <% if defined?(retailer) %>
    <td><%= base_item.user.gln %></td>
    <td><%= base_item.user.name %></td>
    <% end %>
    <td><%= link_to base_item.gtin, base_item_path(path_params) %></td>
    <td><%= link_to base_item.item_description, base_item_path(path_params) %></td>
    <td class="tags">
    <% base_item.item.clouds.find(:all, :conditions =>{:user_id => current_user.id, :item_id => base_item.item.id}).each do |c| %>
    <span class="tag"><%= c.tag.name %></span>
    <% end %>
    </td>
    <td><%= base_item.item.status %></td>
    <td class="date"><%= base_item.created_at.to_s(:short) %></td>
    <!--<td><%#= base_item.status %></td>-->
    <!--<td><%#= link_to 'Destroy', base_item, :confirm => 'Are you sure?', :method => :delete %></td>
    <td><%#= link_to 'Создать на основе этой', :controller => :base_items, :action => :new, :base => base_item.id %></td>
    <td><%#= link_to 'Publish', publish_base_item_path(base_item) %></td>
    <td><%#= link_to 'Accept', accept_base_item_path(base_item) %></td>
    <td><%#= link_to 'Reject', reject_base_item_path(base_item) %></td>-->
  </tr>
<% end %>
</table>

<%= link_to 'New base_item', new_base_item_path if current_user.supplier?%>
</div>
<!--/data-->
